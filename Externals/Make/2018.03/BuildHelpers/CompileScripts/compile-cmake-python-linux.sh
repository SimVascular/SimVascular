#
# python
#

REPLACEME_SV_SPECIAL_COMPILER_SCRIPT

export CC=REPLACEME_CC
export CXX=REPLACEME_CXX

rm -Rf REPLACEME_SV_TOP_BIN_DIR_PYTHON
mkdir -p REPLACEME_SV_TOP_BIN_DIR_PYTHON
chmod u+w,a+rx REPLACEME_SV_TOP_BIN_DIR_PYTHON

rm -Rf REPLACEME_SV_TOP_BLD_DIR_PYTHON
mkdir -p REPLACEME_SV_TOP_BLD_DIR_PYTHON
pushd REPLACEME_SV_TOP_BLD_DIR_PYTHON

REPLACEME_SV_CMAKE_CMD -G REPLACEME_SV_CMAKE_GENERATOR \
   -DBUILD_TESTING:BOOL=OFF \
   -DBUILD_LIBPYTHON_SHARED:BOOL=ON \
   -DENABLE_SSL:BOOL=ON \
   -DBUILTIN_SSL:BOOL=ON \
   -DBUILTIN_HASHLIB:BOOL=ON \
   -DUSE_SYSTEM_OpenSSL:BOOL=OFF \
   -DOPENSSL_INCLUDE_DIR:PATH=REPLACEME_SV_OPENSSL_INC_DIR \
   -DOPENSSL_LIBRARIES:FILEPATH=REPLACEME_SV_OPENSSL_LIBRARIES \
   -DENABLE_CTYPES:BOOL=ON \
   -DBUILTIN_CTYPES:BOOL=ON \
   -DCMAKE_INSTALL_PREFIX:PATH=REPLACEME_SV_TOP_BIN_DIR_PYTHON \
   -DCMAKE_BUILD_TYPE:STRING=REPLACEME_SV_CMAKE_BUILD_TYPE \
   -DPYTHON_VERSION=REPLACEME_SV_PYTHON_FULL_VERSION \
   -DCMAKE_INSTALL_RPATH:PATH=REPLACEME_SV_TOP_BIN_DIR_PYTHON/lib:REPLACEME_SV_TOP_BIN_DIR_PYTHON/lib/python2.7/lib-dynload \
REPLACEME_SV_TOP_SRC_DIR_PYTHON

REPLACEME_SV_MAKE_CMD REPLACEME_SV_PYTHON_MAKE_FILENAME REPLACEME_SV_MAKE_BUILD_PARAMETERS

REPLACEME_SV_MAKE_CMD REPLACEME_SV_PYTHON_MAKE_FILENAME REPLACEME_SV_MAKE_INSTALL_PARAMETERS

# create a wrapper script for python executable

echo "#!/bin/bash -f" > REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "export PYTHONHOME=REPLACEME_SV_TOP_BIN_DIR_PYTHON" >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "export PYTHONPATH=REPLACEME_SV_TOP_BIN_DIR_PYTHON/lib/python2.7/lib-dynload:REPLACEME_SV_TOP_BIN_DIR_PYTHON/lib:REPLACEME_SV_TOP_BIN_DIR_PYTHON/lib/python2.7:REPLACEME_SV_TOP_BIN_DIR_PYTHON/lib/python2.7/site-packages" >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper

echo "if [ \"\$#\" -eq 0 ]; then" >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "  REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python2.7 " >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "elif [ \"\$#\" -eq 1 ]; then" >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "  REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python2.7 \"\$1\" " >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "elif [ \"\$#\" -eq 2 ]; then" >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "  REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python2.7 \"\$1\" \"\$2\" " >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "elif [ \"\$#\" -eq 3 ]; then" >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "  REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python2.7 \"\$1\" \"\$2\" \"\$3\" " >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "else" >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "  REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python2.7 \"\$1\" \"\$2\" \"\$3\" \"\${@:4}\" " >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
echo "fi" >> REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper
chmod u+w,a+rx REPLACEME_SV_TOP_BIN_DIR_PYTHON/bin/python-wrapper

REPLACEME_SV_SPECIAL_COMPILER_END_SCRIPT

popd
